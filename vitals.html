<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GeneShield | Log Vitals</title>
  <link rel="stylesheet" href="css/dashboard.css" />
  <link rel="stylesheet" href="css/vitals.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.2/jspdf.umd.min.js"></script>
  <style>body.auth-pending { visibility: hidden; }</style>
</head>
<body class="auth-pending">

  <aside class="sidebar" id="sidebar">
    <div class="sidebar-brand">
      <img src="logo GeneSheild" alt="GeneShield" style="height:36px;width:36px;border-radius:50%;object-fit:cover;">
      <span class="brand-name">Gene<span class="brand-accent">Shield</span></span>
    </div>
    <nav class="sidebar-nav">
      <a href="dashboard.html" class="nav-item"><i class='bx bx-grid-alt'></i><span>Dashboard</span></a>
      <a href="vitals.html" class="nav-item active"><i class='bx bx-pulse'></i><span>Log Vitals</span></a>
      <a href="chat.html" class="nav-item"><i class='bx bx-bot'></i><span>AI Companion</span></a>
      <a href="#" class="nav-item" onclick="event.preventDefault(); generatePDFReport()"><i class='bx bx-dna'></i><span>Risk Report</span></a>
      <a href="onboarding.html" class="nav-item"><i class='bx bx-user'></i><span>Profile</span></a>
    </nav>
    <div class="sidebar-footer">
      <a href="#" class="nav-item logout" id="logoutBtn"><i class='bx bx-log-out'></i><span>Logout</span></a>
    </div>
  </aside>

  <main class="main-content">
    <header class="topbar">
      <div class="topbar-left">
        <button class="menu-toggle" id="menuToggle"><i class='bx bx-menu'></i></button>
        <div><h1 class="page-title">Log Symptoms & Vitals</h1><p class="page-sub">Track symptoms and health metrics</p></div>
      </div>
    </header>

    <div class="dashboard-body">

      <div class="quick-stats">
        <div class="qs-card"><i class='bx bx-calendar-check'></i><div><span class="qs-num" id="dayStreak">--</span><span class="qs-label">Day Streak</span></div></div>
        <div class="qs-card"><i class='bx bx-list-check'></i><div><span class="qs-num" id="totalLogs">--</span><span class="qs-label">Total Logs</span></div></div>
        <div class="qs-card"><i class='bx bx-trending-up'></i><div><span class="qs-num" id="alertCount">0</span><span class="qs-label">Alerts</span></div></div>
        <div class="qs-card"><i class='bx bx-time'></i><div><span class="qs-num" id="lastLogged">--</span><span class="qs-label">Last Logged</span></div></div>
      </div>

      <div class="vitals-layout">

        <section class="section-block">
          <div class="section-title-row">
            <h3 class="section-title">Record Today's Readings</h3>
            <span class="section-tag" id="logDate"></span>
          </div>

          <div class="vitals-form-grid">
            <div class="vital-input-card">
              <div class="vic-header"><div class="vic-icon bp"><i class='bx bx-pulse'></i></div><div><h4>Blood Pressure</h4><span>mmHg</span></div></div>
              <div class="bp-inputs">
                <div class="bp-field"><label>Systolic</label><input type="number" id="bpSystolic" placeholder="120" min="60" max="250" /></div>
                <div class="bp-divider">/</div>
                <div class="bp-field"><label>Diastolic</label><input type="number" id="bpDiastolic" placeholder="80" min="40" max="150" /></div>
              </div>
              <div class="vic-ref">Normal: &lt;120/80 · Elevated: 120-129 · High: &gt;130/80</div>
            </div>
            <div class="vital-input-card">
              <div class="vic-header"><div class="vic-icon glucose"><i class='bx bx-droplet'></i></div><div><h4>Blood Glucose</h4><span>mmol/L</span></div></div>
              <div class="single-input"><input type="number" id="glucose" placeholder="5.5" min="2" max="30" step="0.1" /></div>
              <div class="vic-ref">Fasting normal: 3.9-5.5 · Pre-diabetes: 5.6-6.9 · Diabetes: >=7.0</div>
            </div>
            <div class="vital-input-card">
              <div class="vic-header"><div class="vic-icon hr"><i class='bx bx-heart'></i></div><div><h4>Heart Rate</h4><span>bpm</span></div></div>
              <div class="single-input"><input type="number" id="heartRate" placeholder="72" min="30" max="220" /></div>
              <div class="vic-ref">Resting normal: 60-100 bpm</div>
            </div>
            <div class="vital-input-card">
              <div class="vic-header"><div class="vic-icon weight"><i class='bx bx-dumbbell'></i></div><div><h4>Weight</h4><span>kg</span></div></div>
              <div class="single-input"><input type="number" id="weight" placeholder="75.0" min="30" max="300" step="0.1" /></div>
              <div class="vic-ref">Track weekly for the most accurate BMI trend</div>
            </div>
            <div class="vital-input-card">
              <div class="vic-header"><div class="vic-icon temp"><i class='bx bx-thermometer'></i></div><div><h4>Temperature</h4><span>°C</span></div></div>
              <div class="single-input"><input type="number" id="temperature" placeholder="36.6" min="34" max="42" step="0.1" /></div>
              <div class="vic-ref">Normal: 36.1-37.2°C · Fever: >=38°C</div>
            </div>
          </div>

          <div class="form-group-v mt-20">
            <label class="v-label">Any symptoms today? <span class="label-hint">(Select all that apply)</span></label>
            <div class="symptom-grid">
              <label class="sym-item"><input type="checkbox" value="unexplained_lump" /><i class='bx bx-search-alt'></i> Unexplained Lump</label>
              <label class="sym-item"><input type="checkbox" value="unexplained_weight_loss" /><i class='bx bx-trending-down'></i> Unexplained Weight Loss</label>
              <label class="sym-item"><input type="checkbox" value="fatigue" /><i class='bx bx-tired'></i> Persistent Fatigue</label>
              <label class="sym-item"><input type="checkbox" value="abnormal_bleeding" /><i class='bx bx-droplet'></i> Abnormal Bleeding</label>
              <label class="sym-item"><input type="checkbox" value="persistent_cough" /><i class='bx bx-wind'></i> Persistent Cough</label>
              <label class="sym-item"><input type="checkbox" value="bowel_changes" /><i class='bx bx-health'></i> Bowel Changes</label>
              <label class="sym-item"><input type="checkbox" value="night_sweats" /><i class='bx bx-moon'></i> Night Sweats</label>
              <label class="sym-item"><input type="checkbox" value="none" /><i class='bx bx-check-circle'></i> No Symptoms</label>
            </div>
          </div>

          <div class="form-group-v mt-16">
            <label class="v-label">Additional Notes</label>
            <textarea id="vitalNotes" placeholder="Any context, e.g. 'Took reading after exercise' or 'Feeling stressed today'..." rows="3"></textarea>
          </div>

          <button class="btn-save-vitals" id="saveVitals"><i class='bx bx-save'></i> Save Today's Reading</button>
        </section>

        <section class="section-block">
          <div class="section-title-row"><h3 class="section-title">Recent History</h3></div>
          <div class="history-list" id="historyList">
            <p style="color:var(--gray);font-size:0.85rem;text-align:center;padding:20px;">No vitals logged yet.</p>
          </div>
        </section>

      </div>
    </div>
  </main>

  <div class="toast" id="toast"><i class='bx bx-check-circle'></i><span>Symptoms logged! Your AI companion has been updated with today's data.</span></div>

  <script src="js/api.js"></script>
  <script src="js/dashboard.js"></script>
  <script src="js/vitals.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const user = await requireAuth();
      if (!user) return;
      document.body.classList.remove('auth-pending');

      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', async (e) => {
          e.preventDefault();
          try { await signOut(); } catch { window.location.href = 'login.html'; }
        });
      }
    });
  </script>
</body>
</html>
