<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GeneShield | Setup Your Profile</title>
  <link rel="stylesheet" href="css/dashboard.css" />
  <link rel="stylesheet" href="css/onboarding.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.2/jspdf.umd.min.js"></script>
  <style>body.auth-pending { visibility: hidden; }</style>
</head>
<body class="auth-pending">

  <aside class="sidebar" id="sidebar">
    <div class="sidebar-brand">
      <img src="logo GeneSheild" alt="GeneShield" style="height:36px;width:36px;border-radius:50%;object-fit:cover;">
      <span class="brand-name">Gene<span class="brand-accent">Shield</span></span>
    </div>
    <nav class="sidebar-nav">
      <a href="dashboard.html" class="nav-item"><i class='bx bx-grid-alt'></i><span>Dashboard</span></a>
      <a href="vitals.html" class="nav-item"><i class='bx bx-pulse'></i><span>Log Vitals</span></a>
      <a href="chat.html" class="nav-item"><i class='bx bx-bot'></i><span>AI Companion</span></a>
      <a href="#" class="nav-item" onclick="event.preventDefault(); generatePDFReport()"><i class='bx bx-dna'></i><span>Risk Report</span></a>
      <a href="#" class="nav-item active"><i class='bx bx-user'></i><span>Profile</span></a>
    </nav>
    <div class="sidebar-footer">
      <a href="#" class="nav-item logout" id="logoutBtn"><i class='bx bx-log-out'></i><span>Logout</span></a>
    </div>
  </aside>

  <main class="main-content">
    <header class="topbar">
      <div class="topbar-left">
        <button class="menu-toggle" id="menuToggle"><i class='bx bx-menu'></i></button>
        <div><h1 class="page-title">Profile</h1><p class="page-sub">Setting up your health profile</p></div>
      </div>
    </header>

    <div class="ob-main">

    <div class="progress-wrap">
      <div class="progress-steps">
        <div class="prog-step active" data-step="1">
          <div class="prog-circle"><i class='bx bx-user'></i></div>
          <span>Personal</span>
        </div>
        <div class="prog-line"></div>
        <div class="prog-step" data-step="2">
          <div class="prog-circle"><i class='bx bx-body'></i></div>
          <span>Health</span>
        </div>
        <div class="prog-line"></div>
        <div class="prog-step" data-step="3">
          <div class="prog-circle"><i class='bx bx-dna'></i></div>
          <span>Family</span>
        </div>
        <div class="prog-line"></div>
        <div class="prog-step" data-step="4">
          <div class="prog-circle"><i class='bx bx-run'></i></div>
          <span>Lifestyle</span>
        </div>
      </div>
      <div class="progress-bar-track">
        <div class="progress-bar-fill" id="progressFill"></div>
      </div>
    </div>

    <div class="ob-card">

      <!-- STEP 1: PERSONAL -->
      <div class="ob-step active" id="step-1">
        <div class="step-header">
          <div class="step-icon-wrap"><i class='bx bx-user'></i></div>
          <h2>Personal Details</h2>
          <p>Let's start with the basics so we can personalise your experience.</p>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>First Name</label>
            <div class="input-wrap"><i class='bx bx-user'></i><input type="text" id="firstName" placeholder="e.g. Boitshalo" /></div>
          </div>
          <div class="form-group">
            <label>Last Name</label>
            <div class="input-wrap"><i class='bx bx-user'></i><input type="text" id="lastName" placeholder="e.g. Moeng" /></div>
          </div>
          <div class="form-group">
            <label>Date of Birth</label>
            <div class="input-wrap"><i class='bx bx-calendar'></i><input type="date" id="dob" /></div>
          </div>
          <div class="form-group">
            <label>Gender</label>
            <div class="input-wrap">
              <i class='bx bx-male-female'></i>
              <select id="gender">
                <option value="">Select gender</option>
                <option>Male</option><option>Female</option><option>Prefer not to say</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label>Phone Number</label>
            <div class="input-wrap"><i class='bx bx-phone'></i><input type="tel" id="phone" placeholder="+267 71 234 567" /></div>
          </div>
          <div class="form-group">
            <label>Location (District)</label>
            <div class="input-wrap">
              <i class='bx bx-map'></i>
              <select id="district">
                <option value="">Select district</option>
                <option>Gaborone</option><option>Francistown</option><option>Maun</option>
                <option>Serowe</option><option>Palapye</option><option>Lobatse</option>
                <option>Kasane</option><option>Other</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <!-- STEP 2: HEALTH -->
      <div class="ob-step" id="step-2">
        <div class="step-header">
          <div class="step-icon-wrap"><i class='bx bx-body'></i></div>
          <h2>Your Current Health</h2>
          <p>Tell us about your current physical condition and any existing diagnoses.</p>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>Height (cm)</label>
            <div class="input-wrap"><i class='bx bx-ruler'></i><input type="number" id="height" placeholder="e.g. 172" min="100" max="250" /></div>
          </div>
          <div class="form-group">
            <label>Weight (kg)</label>
            <div class="input-wrap"><i class='bx bx-dumbbell'></i><input type="number" id="weight" placeholder="e.g. 75" min="30" max="300" /></div>
          </div>
          <div class="form-group full-width">
            <label>Blood Type</label>
            <div class="input-wrap">
              <i class='bx bx-droplet'></i>
              <select id="bloodType">
                <option value="">Select blood type</option>
                <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
                <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option><option>Unknown</option>
              </select>
            </div>
          </div>
        </div>
        <div class="form-group full-width mt-16">
          <label>Do you currently have any of these conditions? <span class="label-hint">(Select all that apply)</span></label>
          <div class="checkbox-grid" id="conditionsGrid">
            <label class="check-item"><input type="checkbox" value="breast_cancer" /><i class='bx bx-ribbon'></i> Breast Cancer</label>
            <label class="check-item"><input type="checkbox" value="cervical_cancer" /><i class='bx bx-female'></i> Cervical Cancer</label>
            <label class="check-item"><input type="checkbox" value="colorectal_cancer" /><i class='bx bx-dna'></i> Colorectal Cancer</label>
            <label class="check-item"><input type="checkbox" value="prostate_cancer" /><i class='bx bx-male'></i> Prostate Cancer</label>
            <label class="check-item"><input type="checkbox" value="skin_cancer" /><i class='bx bx-sun'></i> Skin Cancer</label>
            <label class="check-item"><input type="checkbox" value="lung_cancer" /><i class='bx bx-wind'></i> Lung Cancer</label>
            <label class="check-item"><input type="checkbox" value="other_cancer" /><i class='bx bx-plus-medical'></i> Other Cancer</label>
            <label class="check-item"><input type="checkbox" value="none" id="noneCheck" /><i class='bx bx-check-circle'></i> None</label>
          </div>
        </div>
        <div class="form-group full-width mt-16">
          <label>Any current medications?</label>
          <div class="input-wrap"><i class='bx bx-capsule'></i><input type="text" id="medications" placeholder="e.g. Metformin, Lisinopril (or leave blank)" /></div>
        </div>
      </div>

      <!-- STEP 3: FAMILY HISTORY -->
      <div class="ob-step" id="step-3">
        <div class="step-header">
          <div class="step-icon-wrap"><i class='bx bx-dna'></i></div>
          <h2>Family Cancer History</h2>
          <p>This is the heart of GeneShield. Your family's cancer diagnoses directly shape your hereditary risk score.</p>
        </div>
        <div class="family-section">
          <div class="family-member-label"><i class='bx bx-male'></i> Father's Side</div>
          <div class="checkbox-grid">
            <label class="check-item"><input type="checkbox" name="father" value="breast_cancer" /><i class='bx bx-ribbon'></i> Breast Cancer</label>
            <label class="check-item"><input type="checkbox" name="father" value="colorectal_cancer" /><i class='bx bx-dna'></i> Colorectal Cancer</label>
            <label class="check-item"><input type="checkbox" name="father" value="prostate_cancer" /><i class='bx bx-male'></i> Prostate Cancer</label>
            <label class="check-item"><input type="checkbox" name="father" value="lung_cancer" /><i class='bx bx-wind'></i> Lung Cancer</label>
            <label class="check-item"><input type="checkbox" name="father" value="skin_cancer" /><i class='bx bx-sun'></i> Skin Cancer</label>
            <label class="check-item"><input type="checkbox" name="father" value="stomach_cancer" /><i class='bx bx-body'></i> Stomach Cancer</label>
            <label class="check-item"><input type="checkbox" name="father" value="other_cancer" /><i class='bx bx-plus-medical'></i> Other Cancer</label>
            <label class="check-item"><input type="checkbox" name="father" value="unknown" /><i class='bx bx-question-mark'></i> Unknown</label>
          </div>
        </div>
        <div class="family-section">
          <div class="family-member-label"><i class='bx bx-female'></i> Mother's Side</div>
          <div class="checkbox-grid">
            <label class="check-item"><input type="checkbox" name="mother" value="breast_cancer" /><i class='bx bx-ribbon'></i> Breast Cancer</label>
            <label class="check-item"><input type="checkbox" name="mother" value="cervical_cancer" /><i class='bx bx-female'></i> Cervical Cancer</label>
            <label class="check-item"><input type="checkbox" name="mother" value="colorectal_cancer" /><i class='bx bx-dna'></i> Colorectal Cancer</label>
            <label class="check-item"><input type="checkbox" name="mother" value="ovarian_cancer" /><i class='bx bx-plus-medical'></i> Ovarian Cancer</label>
            <label class="check-item"><input type="checkbox" name="mother" value="lung_cancer" /><i class='bx bx-wind'></i> Lung Cancer</label>
            <label class="check-item"><input type="checkbox" name="mother" value="skin_cancer" /><i class='bx bx-sun'></i> Skin Cancer</label>
            <label class="check-item"><input type="checkbox" name="mother" value="other_cancer" /><i class='bx bx-plus-medical'></i> Other Cancer</label>
            <label class="check-item"><input type="checkbox" name="mother" value="unknown" /><i class='bx bx-question-mark'></i> Unknown</label>
          </div>
        </div>
        <div class="family-section">
          <div class="family-member-label"><i class='bx bx-group'></i> Grandparents (any side)</div>
          <div class="checkbox-grid">
            <label class="check-item"><input type="checkbox" name="grand" value="breast_cancer" /><i class='bx bx-ribbon'></i> Breast Cancer</label>
            <label class="check-item"><input type="checkbox" name="grand" value="cervical_cancer" /><i class='bx bx-female'></i> Cervical Cancer</label>
            <label class="check-item"><input type="checkbox" name="grand" value="colorectal_cancer" /><i class='bx bx-dna'></i> Colorectal Cancer</label>
            <label class="check-item"><input type="checkbox" name="grand" value="prostate_cancer" /><i class='bx bx-male'></i> Prostate Cancer</label>
            <label class="check-item"><input type="checkbox" name="grand" value="ovarian_cancer" /><i class='bx bx-plus-medical'></i> Ovarian Cancer</label>
            <label class="check-item"><input type="checkbox" name="grand" value="lung_cancer" /><i class='bx bx-wind'></i> Lung Cancer</label>
            <label class="check-item"><input type="checkbox" name="grand" value="other_cancer" /><i class='bx bx-plus-medical'></i> Other Cancer</label>
            <label class="check-item"><input type="checkbox" name="grand" value="unknown" /><i class='bx bx-question-mark'></i> Unknown</label>
          </div>
        </div>
        <div class="info-banner">
          <i class='bx bx-lock-alt'></i>
          <p>Your family health data is encrypted and never shared. It is used solely to generate your personal risk score.</p>
        </div>
      </div>

      <!-- STEP 4: LIFESTYLE -->
      <div class="ob-step" id="step-4">
        <div class="step-header">
          <div class="step-icon-wrap"><i class='bx bx-run'></i></div>
          <h2>Your Lifestyle</h2>
          <p>Lifestyle factors are key risk amplifiers. Be honest â€” this is for your benefit.</p>
        </div>
        <div class="form-group full-width">
          <label>How often do you exercise?</label>
          <div class="option-cards" id="exerciseOptions">
            <div class="option-card" data-value="never"><i class='bx bx-x-circle'></i><span>Never</span></div>
            <div class="option-card" data-value="rarely"><i class='bx bx-time'></i><span>Rarely</span></div>
            <div class="option-card" data-value="sometimes"><i class='bx bx-walk'></i><span>1-2x / week</span></div>
            <div class="option-card" data-value="regularly"><i class='bx bx-run'></i><span>3-4x / week</span></div>
            <div class="option-card" data-value="daily"><i class='bx bx-cycling'></i><span>Daily</span></div>
          </div>
        </div>
        <div class="form-group full-width mt-24">
          <label>How would you describe your diet?</label>
          <div class="option-cards" id="dietOptions">
            <div class="option-card" data-value="poor"><i class='bx bx-fast-food'></i><span>Mostly fast food</span></div>
            <div class="option-card" data-value="average"><i class='bx bx-bowl-rice'></i><span>Average / mixed</span></div>
            <div class="option-card" data-value="good"><i class='bx bx-leaf'></i><span>Fairly healthy</span></div>
            <div class="option-card" data-value="excellent"><i class='bx bx-heart'></i><span>Very healthy</span></div>
          </div>
        </div>
        <div class="form-row mt-24">
          <div class="form-group">
            <label>Do you smoke?</label>
            <div class="toggle-options" id="smokeOptions">
              <div class="toggle-opt" data-value="no">No</div>
              <div class="toggle-opt" data-value="occasionally">Occasionally</div>
              <div class="toggle-opt" data-value="yes">Yes</div>
            </div>
          </div>
          <div class="form-group">
            <label>Do you drink alcohol?</label>
            <div class="toggle-options" id="alcoholOptions">
              <div class="toggle-opt" data-value="no">No</div>
              <div class="toggle-opt" data-value="occasionally">Occasionally</div>
              <div class="toggle-opt" data-value="yes">Regularly</div>
            </div>
          </div>
        </div>
        <div class="form-group full-width mt-24">
          <label>Average sleep per night</label>
          <div class="option-cards" id="sleepOptions">
            <div class="option-card" data-value="lt5"><i class='bx bx-moon'></i><span>Less than 5hrs</span></div>
            <div class="option-card" data-value="5-6"><i class='bx bx-moon'></i><span>5-6 hrs</span></div>
            <div class="option-card" data-value="7-8"><i class='bx bx-moon'></i><span>7-8 hrs</span></div>
            <div class="option-card" data-value="gt8"><i class='bx bx-moon'></i><span>More than 8hrs</span></div>
          </div>
        </div>
        <div class="success-banner mt-24">
          <i class='bx bx-check-circle'></i>
          <div>
            <strong>You're almost done!</strong>
            <p>After submitting, GeneShield will generate your personalised hereditary cancer risk score and screening plan.</p>
          </div>
        </div>
      </div>

      <div class="ob-nav">
        <button class="btn-back" id="backBtn" onclick="changeStep(-1)"><i class='bx bx-left-arrow-alt'></i> Back</button>
        <div class="step-counter" id="stepCounter">Step 1 of 4</div>
        <button class="btn-next" id="nextBtn" onclick="changeStep(1)">Next <i class='bx bx-right-arrow-alt'></i></button>
      </div>

    </div> <!-- end ob-card -->
    </div> <!-- end .ob-main -->
  </main>

  <script src="js/api.js"></script>
  <script src="js/onboarding.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const user = await requireAuth();
      if (!user) return;
      document.body.classList.remove('auth-pending');

      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', async (e) => {
          e.preventDefault();
          try { await signOut(); } catch { window.location.href = 'login.html'; }
        });
      }
    });
  </script>
</body>
</html>
